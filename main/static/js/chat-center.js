/**
 * By Noble H. Mushtak
 * In Public Domain
 * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
 */
var purify_config={ALLOWED_TAGS:["I","B","U","S","MARK","EM","STRONG","INS","DEL","SMALL","SUB","SUP","DFN","ABBR","BDI","BDO","PRE","CODE","SAMP","KBD","VAR","H1","H2","H3","H4","H5","H6","RUBY","RT","RP","A","SPAN","P","DIV","FIGURE","FIGCAPTION","DETAILS","SUMMARY","BR","WBR","HR","UL","OL","LI","DL","DD","DT","TABLE","TBODY","THEAD","TFOOT","TR","TD","TH","CAPTION","COLGROUP","COL","SECTION","NAV","ARTICLE","ASIDE","ADDRESS","HEADER","FOOTER","CITE","INPUT","SELECT","OPTION","TEXTAREA","BUTTON","TIME"],ALLOWED_ATTR:["href"]};DOMPurify.addHook("afterSanitizeAttributes",function(e){e.nodeName&&"a"==e.nodeName.toLowerCase()&&(e.setAttribute("target","_blank"),e.setAttribute("rel","nofollow"))});var chatDisplay=document.getElementById("chat-display"),message=document.getElementById("message"),infoElem=document.getElementById("info-element"),formatters=document.forms.commentPoster.formatting,submitter=document.forms.commentPoster.submitter,moreComments=document.getElementById("more-comments");function resetChats(){for(;chatDisplay.childNodes.length;)chatDisplay.removeChild(chatDisplay.childNodes[0])}var formatter,safe=function(e,t){moreComments.parentNode===chatDisplay&&chatDisplay.removeChild(moreComments);for(var a=t?e.length-1:0;t?a>=0:a<e.length;t?--a:++a){var n=e[a].name,i=e[a].text,m=document.createElement("div");m.classList.add("chat-item");var s=document.createElement("div");s.classList.add("chat-info"),s.textContent=n;var o=document.createElement("div");if(o.classList.add("chat-info"),o.textContent="Posted on "+(e[a].hasOwnProperty("time")?e[a].time:"an unknown")+" time",e[a].hasOwnProperty("time")){o.textContent=o.textContent.substring(0,o.textContent.length-8);var r=document.createElement("a");r.setAttribute("href","http://www.greenwichmeantime.com/"),r.setAttribute("target","_blank"),r.textContent="GMT time",o.appendChild(r)}m.appendChild(s),m.appendChild(o),m.appendChild(document.createElement("br"));var c=document.createElement("div");c.classList.add("comment"),c.innerHTML=DOMPurify.sanitize(i,purify_config),m.appendChild(c),t?chatDisplay.insertBefore(m,chatDisplay.firstChild):chatDisplay.appendChild(m),c.clientHeight||chatDisplay.removeChild(m),c.clientHeight>chatDisplay.clientHeight/2&&(c.style.height=chatDisplay.clientHeight/2+"px",c.style.overflow="auto")}numComments<numTotalComments&&chatDisplay.insertBefore(moreComments,chatDisplay.firstChild)},info=[[],[]],genCodeElem=function(e){var t=document.createElement("code");return t.classList.add("code"),t.textContent=e,t},_min={};_min.c=document.createTextNode.bind(document),_min.g=genCodeElem;for(var i=0;i<18;i++){info[0].push(document.createElement("li"));var a=info[0][i].appendChild.bind(info[0][i]);switch(i){case 0:a(_min.g("i")),a(_min.c(", ")),a(_min.g("b")),a(_min.c(", ")),a(_min.g("u")),a(_min.c(", ")),a(_min.g("s")),a(_min.c(", ")),a(_min.g("mark")),a(_min.c(", ")),a(_min.g("em")),a(_min.c(", ")),a(_min.g("strong")),a(_min.c(", ")),a(_min.g("ins")),a(_min.c(", and ")),a(_min.g("del")),a(_min.c(" tags are allowed."));break;case 1:a(_min.g("small")),a(_min.c(", ")),a(_min.g("sub")),a(_min.c(", ")),a(_min.g("sup")),a(_min.c(", ")),a(_min.g("dfn")),a(_min.c(", ")),a(_min.g("abbr")),a(_min.c(", ")),a(_min.g("bdi")),a(_min.c(", and ")),a(_min.g("bdo")),a(_min.c(" tags are allowed."));break;case 2:a(_min.g("pre")),a(_min.c(", ")),a(_min.g("code")),a(_min.c(", ")),a(_min.g("samp")),a(_min.c(", ")),a(_min.g("kbd")),a(_min.c(", and ")),a(_min.g("var")),a(_min.c(" tags are allowed."));break;case 3:a(_min.g("h1")),a(_min.c(", ")),a(_min.g("h2")),a(_min.c(", ")),a(_min.g("h3")),a(_min.c(", ")),a(_min.g("h4")),a(_min.c(", ")),a(_min.g("h5")),a(_min.c(", ")),a(_min.g("h6")),a(_min.c(" tags are allowed."));break;case 4:a(_min.g("ruby")),a(_min.c(", ")),a(_min.g("rt")),a(_min.c(", and ")),a(_min.g("rp")),a(_min.c(" tags are allowed."));break;case 5:a(_min.g("a")),a(_min.c(" tags are allowed."));break;case 6:a(_min.g("span")),a(_min.c(", ")),a(_min.g("p")),a(_min.c(", and ")),a(_min.g("div")),a(_min.c(" tags are allowed."));break;case 7:a(_min.g("figure")),a(_min.c(" and ")),a(_min.g("figcaption")),a(_min.c(" tags are allowed."));break;case 8:a(_min.g("details")),a(_min.c(" and ")),a(_min.g("summary")),a(_min.c(" tags are allowed."));break;case 9:a(_min.g("br")),a(_min.c(", ")),a(_min.g("wbr")),a(_min.c(", and ")),a(_min.g("hr")),a(_min.c(" tags are allowed."));break;case 10:a(_min.c("Newlines will not automatically be replaced with ")),a(_min.g("br")),a(_min.c(" tags: ")),a(_min.g("br")),a(_min.c(" tags must be manually placed within the code when a newline is wanted."));break;case 11:a(_min.g("ul")),a(_min.c(", ")),a(_min.g("ol")),a(_min.c(", and ")),a(_min.g("li")),a(_min.c(" tags are allowed."));break;case 12:a(_min.g("dl")),a(_min.c(", ")),a(_min.g("dd")),a(_min.c(", and ")),a(_min.g("dt")),a(_min.c(" tags are allowed."));break;case 13:a(_min.g("table")),a(_min.c(", ")),a(_min.g("tbody")),a(_min.c(", ")),a(_min.g("thead")),a(_min.c(", ")),a(_min.g("tfoot")),a(_min.c(", ")),a(_min.g("tr")),a(_min.c(", ")),a(_min.g("td")),a(_min.c(", ")),a(_min.g("th")),a(_min.c(" ")),a(_min.g("caption")),a(_min.c(", ")),a(_min.g("colgroup")),a(_min.c(", and ")),a(_min.g("col")),a(_min.c(" tags are allowed."));break;case 14:a(_min.g("section")),a(_min.c(", ")),a(_min.g("nav")),a(_min.c(", ")),a(_min.g("article")),a(_min.c(", ")),a(_min.g("aside")),a(_min.c(", ")),a(_min.g("address")),a(_min.c(", ")),a(_min.g("header")),a(_min.c(", ")),a(_min.g("footer")),a(_min.c(", and ")),a(_min.g("cite")),a(_min.c(" tags are allowed."));break;case 15:a(_min.g("input")),a(_min.c(", ")),a(_min.g("select")),a(_min.c(", ")),a(_min.g("option")),a(_min.c(", ")),a(_min.g("textarea")),a(_min.c(", and ")),a(_min.g("button")),a(_min.c(" tags are allowed."));break;case 16:a(_min.g("time")),a(_min.c(" tags are allowed."));break;case 17:a(_min.c("Using any attributes other than the ")),a(_min.g("href")),a(_min.c(" attribute is not allowed."))}}for(i=0;i<1;i++){info[1].push(document.createElement("li"));a=info[1][i].appendChild.bind(info[1][i]);switch(i){case 0:a(_min.c("Message will appear as plaintext, without any formatting"))}}var formattingChange=function(){if(this.checked){for(;infoElem.childNodes.length;)infoElem.removeChild(infoElem.childNodes[0]);formatter=parseFloat(this.value);for(var e=0;e<info[formatter].length;e++)infoElem.appendChild(info[formatter][e])}};for(i=0;i<formatters.length;i++){var func=formattingChange.bind(formatters[i]);formatters[i].addEventListener("input",func),formatters[i].checked&&func()}var slug=window.location.pathname,getRequest=function(e,t,a){var n=new XMLHttpRequest;n.open("GET",e,!!t),"function"==typeof a&&(n.onreadystatechange=a),n.link=e.substring(0,e.indexOf("?")),n.link?n.params=e.substring(e.indexOf("?")+1,e.length):n.link=e,n.send()},waitRequest=function(){var e="/get-new-chats?last_num_comments="+numTotalComments+"&slug="+slug,t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=waitRequest.stateChanger,t.link=e,t.send()};waitRequest.stateChanger=function(){var e=!1;if(this.status>=400&&4===this.readyState)popups.alert(this.response||"Something went wrong and we don't know what...Sorry!","OK");else if(200===this.status&&4===this.readyState){initialCommentCleared||(resetChats(),initialCommentCleared=!0);var t=JSON.parse(this.response);numTotalComments=t.numTotalComments,t.comments.length>0&&(e=!0,safe(t.comments,!1))}this.status>=200&&this.status<300&&4===this.readyState&&setTimeout(waitRequest,500),e&&(chatDisplay.scrollTop=chatDisplay.scrollHeight,commentsDisabled=!1,message.textContent="")};var commentsDisabled=!1,initialCommentCleared=!1,numComments=100,numTotalComments=0,getComments=function(){if(commentsDisabled)popups.alert("Please wait before getting more comments! This might've happened if you tried to get comments while we were posting one of your comments.","OK");else{info={start:numComments+=50,end:numComments-50},submitter.style.display=moreComments.style.display="none",commentsDisabled=!0,message.textContent="Getting more comments...";var e="/get-chats?start="+info.start+"&end="+info.end+"&slug="+slug;getRequest(e,!0,getComments.stateChanger)}};getComments.stateChanger=function(){this.status>=400&&4===this.readyState?popups.alert(this.response||"Something went wrong and we don't know what...Sorry!","OK"):200===this.status&&4==this.readyState&&(response=JSON.parse(this.response),safe(response.comments,!0)),4===this.readyState&&(moreComments.style.display="inline-block",submitter.style.display="block",message.textContent="",commentsDisabled=!1)};var postComment=function(e){e.preventDefault(),commentsDisabled?popups.alert("Please wait a little before posting another comment again! This might've happened if you pressed Enter a bunch in the name field to post multiple comments quickly or if you tried to post a comment while we were trying to get additional comments for you from the database.","OK"):this.text.value?this.text.value.length>3e3?popups.alert("Please keep your comment under 3000 characters. Thank you!","OK"):this.name.value?this.name.value.length>60?popups.alert("Please keep your name under 60 characters. Thank you!","OK"):(message.textContent="Posting the comment...",submitter.style.display=moreComments.style.display="none",commentsDisabled=!0,setTimeout(postComment.sender.bind({text:this.text.value,name:this.name.value,formatting:formatter,token:this.csrfmiddlewaretoken.value}),1),console.log("SDFG")):popups.alert("Remember to fill in your name!","OK"):popups.alert("Remember to type something into your comment!","OK")};postComment.sender=function(){var e=new XMLHttpRequest;e.open("POST","/post-chat",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("X-CSRFToken",this.token),e.onreadystatechange=postComment.stateChanger,e.send("text="+encodeURIComponent(this.text)+"&name="+encodeURIComponent(this.name)+"&formatting="+encodeURIComponent(this.formatting)+"&slug="+slug)},postComment.stateChanger=function(){4===this.readyState&&(moreComments.style.display="inline-block",submitter.style.display="block"),this.status>=400&&4===this.readyState?(popups.alert(this.response||"Something went wrong and we don't know what...Sorry!","OK"),message.textContent=""):204===this.status&&4===this.readyState&&message.textContent&&(message.textContent="Checking for changes to comments...")};var sizeElems=function(){var e=(chatDisplay.scrollTop+chatDisplay.clientHeight)/chatDisplay.scrollHeight;chatDisplay.style.height=chatDisplayRatio*document.documentElement.clientHeight+"px",document.forms.commentPoster.text.style.height=commentPosterRatio*document.documentElement.clientHeight+"px",document.forms.commentPoster.style.height="auto",chatDisplay.scrollTop=e*chatDisplay.scrollHeight-chatDisplay.clientHeight};window.addEventListener("resize",sizeElems);var checkLength=function(){message.textContent="";var e=document.forms.commentPoster.text,t=document.forms.commentPoster.name,a=!1;e.value.length>3e3&&(message.textContent+="Your comment is too long! It must be under 3000 characters.",a=!0),t.value.length>60&&(a&&(message.textContent+=" "),message.textContent+="Your name is too long! It must be under 60 characters.",a=!0)};function loadChatCenter(){sizeElems(),getRequest("/get-chats?slug="+slug,!0,waitRequest.stateChanger),moreComments.addEventListener(mouseevents.click,getComments),submitter.addEventListener(mouseevents.click,postComment.bind(document.forms.commentPoster))}document.forms.commentPoster.text.addEventListener("input",checkLength),document.forms.commentPoster.name.addEventListener("input",checkLength);